name: "terraform check"

on:
  pull_request:
    branches: ["main"]

jobs:
  terraform:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v1

      - name: Set up GCP CLI
        uses: google-github-actions/setup-gcloud@v0.4.0
        with:
          version: "356.0.0"
          project_id: "firm-reason-411722"
          service_account_key: "ewogICJ0eXBlIjogInNlcnZpY2VfYWNjb3VudCIsCiAgInByb2plY3RfaWQiOiAiZmlybS1yZWFzb24tNDExNzIyIiwKICAicHJpdmF0ZV9rZXlfaWQiOiAiMmYzOTViMjg4ZWE3M2M5NGU3Y2ExM2QwOTgxYmUzZTBhYzZkZDZiMiIsCiAgInByaXZhdGVfa2V5IjogIi0tLS0tQkVHSU4gUFJJVkFURSBLRVktLS0tLVxuTUlJRXZBSUJBREFOQmdrcWhraUc5dzBCQVFFRkFBU0NCS1l3Z2dTaUFnRUFBb0lCQVFEVXF1S2NtaFlVMEtTZVxuWkt1TUZ3OVpMbjc3aDdUMVEyN3h3U1ZXY0NYMXI2QndsSUFqVHZhOHBDQ1ByekM1MlVpb0pxZ3NDSllJQTJaVVxuWi9EcEZxdllBR2h4ZVVZZThYOGRiNG85T1kyWEpzQ245dmNGSVBOSGx0K3B4Wjh5OUlhdU9udE8wUEFNNWF3ZlxuMWtpTldFUEZYQThybHhzU0puUlFkMzZMK1JadEJyZTVBTHE4Y2Jwb09UMnIvakswanlyZEFzd3ZEYVYxVFBxZFxuUGdubk90MXovSXZlcFZCNTV5VFJOY3I1QWNKWVpCQmFhTzlacVhPd0R4MGdWdnQ4d3pLbThMaDNsUkc3THlzN1xuWlI4ZnJOMHpWSUdhdGRSaXRUYzBYQWF3UW5OZ24vNXRDSUl2U3BiZ3BUWTI4M0haYUdOclpMZlJDeVpEcy82V1xuNzJac3FIajVBZ01CQUFFQ2dnRUFCajlwbmpyVFN6NlY3TkZTK05xZlBpVFBpNG1CRjNOK1h1Wjl0NmNKSVI2aVxuYUFHZmdoUzFJRXJ5Rkp2Zzkrb2FQYXU2WlJER0xPdHNwaTRuaXdiUGV1NWRlSGZ5UjJ2R0t1YzJveUI5dUdNUVxuWmQ3V0xhQmsycHJrRno0UnRKTGFkMlBnY05XbjRtUEhtcjByaEh1RFY0T2lMblduVUp2YlJFSHBHeWp3Mm1NUFxud2svTDJObmNsU0s1OFJaUlF0a1V4VFo3TjNORDVQTmxzWDVxV0RMZVArUDlieSsreTFQNDNjdnNaK3BUY0MxYlxuNGJONHdLbk5ra0NvSjhjbzlhRUJwUEFkVXdUUndwOXluMkRNL2FjMkI0THpNcFZSb0ZVaFByN3J3RS9VakQrQVxuak0relNobkV6dTRUZCtXb25wSFV3Y1IwVzI3VXFwME52TWRkMTRxRndRS0JnUURxWW1FMmIvV3ZpeC95dDFVWlxuRCt1OEFTZmp6eTNnOFJiUCtDSVRMMlJUZTEvcE1TRmZnU0hMa1A4WmxUOENlc1Q5QS9maUh3ZkU4MmR0UVhPMlxuSjNGVWZiZ0JmZXdxd3M5S05CK29OQWNqU3hsOWR2a25DVGkrTUM4RWdSWWl2Q3BVVmdGYlFydHBSNEVZVG1NV1xuOG5vNVgyR1Z6RHlPWmlWQjBjb3R6OXY0L3dLQmdRRG9SOHBQWWJWNE5HcEI4RjhKaUZEZWE3dWwvWUZjbVRtM1xuSFIzdmROY1pqMXgxbEZ4L2RJQzJuMCtUR0dmaldESmtUZ1NVMVpmOVJGWXJqdGlKSU8rL2xqSUlIQjluQzF4WVxuVWZ3eVZ1RE43dFpQL2JxeSt2c3pBVkV5Z2dWZ0RrclZJT3d3OTVacUl3cEUwMzZPMFBuRy8zRHh6K2diN2FPY1xuUXJHaklRRldCd0tCZ0dNK2dQY3g5US85a3V1TklXVlpUbkh1ODFzTTBOcGNlMUpZT09WeXZjSnpqU3NLZUowZFxuNnBkdHIvYS9NVXoxZXcrL2JHaTh4dWRvUVRVTDc5a0RYb051TUVuQmJneTFMRnk1TVdaaGtWd3FZb0t6cTlBUlxub1lzMmo5SVNick1LaGNuc0dPcnhtTFY5WjNaSlNyL2VzRTQyeXZWSTQ2TlFNUnByb0haQmUxMDFBb0dBVHZTZ1xuTTAyT1J0YmlTNW11WkdvZXV3dzUwOW1SRUczUkxZcExNNnN1dHJTQmhFSXpFdXdDR0pHY2xlNlUyYldRSTRKVlxua2xYc2ZSMnVnTTNra3ZCTUxuNmFjU0ZHRjF2SVB3bFhSYkU4WnlQSlc1VnUwZ240TzBVMldZblMwK3pueVB5UVxuN0xBc1E5VzNWdC9oUkNDSzF2YmJhSWI0YWcza01HaUhRMkVqdUI4Q2dZQi9Ud2FrU1c4dnFBVG82K0hNUmI2Z1xuelA2d3ZIUTUrWVZkMHJFYWxGQVY4a0NsZG45endyODFlV0JzSzUrclRjSHVSSktMRDd1c0ZTNHEyeWQ1WW1YaFxuQWxOUzc5Z3VXallyUGlQdUQ2VUN5MmpqSXloVFcvOGpISGgwdHYzM3B5bEd4U29GQUxCUXpXZUFkanlxa3BRclxuRUJBVnJlamJvK1BjYVNVbldmWCtsUT09XG4tLS0tLUVORCBQUklWQVRFIEtFWS0tLS0tXG4iLAogICJjbGllbnRfZW1haWwiOiAiMjM0NDc1NzA5MTE0LWNvbXB1dGVAZGV2ZWxvcGVyLmdzZXJ2aWNlYWNjb3VudC5jb20iLAogICJjbGllbnRfaWQiOiAiMTEwODc5MzI5MzIxMDM3Njk1Mzk5IiwKICAiYXV0aF91cmkiOiAiaHR0cHM6Ly9hY2NvdW50cy5nb29nbGUuY29tL28vb2F1dGgyL2F1dGgiLAogICJ0b2tlbl91cmkiOiAiaHR0cHM6Ly9vYXV0aDIuZ29vZ2xlYXBpcy5jb20vdG9rZW4iLAogICJhdXRoX3Byb3ZpZGVyX3g1MDlfY2VydF91cmwiOiAiaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20vb2F1dGgyL3YxL2NlcnRzIiwKICAiY2xpZW50X3g1MDlfY2VydF91cmwiOiAiaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20vcm9ib3QvdjEvbWV0YWRhdGEveDUwOS8yMzQ0NzU3MDkxMTQtY29tcHV0ZSU0MGRldmVsb3Blci5nc2VydmljZWFjY291bnQuY29tIiwKICAidW5pdmVyc2VfZG9tYWluIjogImdvb2dsZWFwaXMuY29tIgp9Cg=="
          export_default_credentials: true
          
      - name: Terraform Init
        run: terraform init

      - name: Terraform Format
        run: terraform fmt -check

      - name: Terraform Plan
        run: terraform plan -input=false
